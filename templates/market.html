<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Tracker - IntelliVest</title>

    <!-- Performance & Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        [v-cloak] {
            display: none !important;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0B0E14;
            color: #E2E8F0;
        }

        body.light-mode {
            background-color: #F8FAFC;
            color: #0F172A;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(148, 163, 184, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 1rem;
        }

        body.light-mode .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(203, 213, 225, 0.5);
        }

        .text-up {
            color: #10B981;
        }

        .text-down {
            color: #EF4444;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden">
    <div id="app" class="flex w-full h-full" v-cloak>
        <!-- Sidebar -->
        <aside class="hidden lg:flex lg:w-64 flex-shrink-0 border-r border-slate-800 bg-[#0F1219] flex-col">
            <div class="h-20 flex items-center px-6 border-b border-slate-800">
                <i class="fas fa-bolt text-2xl text-purple-500"></i>
                <span class="ml-3 text-xl font-bold">IntelliVest</span>
            </div>
            <nav class="flex-1 py-6 px-4 space-y-2">
                <a href="/"
                    class="flex items-center p-3 rounded-xl text-slate-400 hover:bg-slate-800 transition-colors">
                    <i class="fas fa-chart-line w-8"></i> Overview
                </a>
                <a href="/market" class="flex items-center p-3 rounded-xl bg-purple-500/10 text-purple-400">
                    <i class="fas fa-chart-bar w-8"></i> Market (BSE)
                </a>
                <a href="/budgets"
                    class="flex items-center p-3 rounded-xl text-slate-400 hover:bg-slate-800 transition-colors">
                    <i class="fas fa-wallet w-8"></i> Budgets
                </a>
                <a href="/invest"
                    class="flex items-center p-3 rounded-xl text-slate-400 hover:bg-slate-800 transition-colors">
                    <i class="fas fa-brain w-8"></i> AI Advisor
                </a>
                <button @click="showDonate = true"
                    class="w-full flex items-center p-3 rounded-xl text-pink-400 hover:bg-pink-500/10 transition-colors">
                    <i class="fas fa-heart w-8"></i> Donate
                </button>
            </nav>
            <div class="p-4 border-t border-slate-800 mt-auto">
                <div @click="showProfileMenu = !showProfileMenu"
                    class="bg-slate-800/50 p-4 rounded-xl border border-white/5 cursor-pointer hover:bg-slate-800 relative">
                    <div class="flex items-center space-x-3">
                        <div
                            class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-xs font-bold">
                            [[ session.initials ]]
                        </div>
                        <div class="overflow-hidden">
                            <div class="text-sm font-semibold truncate">[[ session.name ]]</div>
                            <div class="text-[10px] text-slate-400 truncate">[[ session.user ]]</div>
                        </div>
                    </div>
                    <!-- Menu -->
                    <div v-if="showProfileMenu"
                        class="absolute bottom-full left-0 right-0 mb-2 bg-slate-900 border border-slate-700 rounded-xl overflow-hidden shadow-2xl z-50">
                        <a href="/settings" class="block p-3 text-sm hover:bg-slate-800"><i class="fas fa-cog mr-2"></i>
                            Settings</a>
                        <a href="/logout" class="block p-3 text-sm text-red-400 hover:bg-slate-800"><i
                                class="fas fa-sign-out-alt mr-2"></i> Logout</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Nav -->
        <nav
            class="lg:hidden fixed bottom-0 inset-x-0 bg-[#0F1219] border-t border-slate-800 flex justify-around items-center h-16 z-50">
            <a href="/" class="text-slate-500 flex flex-col items-center"><i class="fas fa-chart-line"></i><span
                    class="text-[10px]">Home</span></a>
            <a href="/market" class="text-purple-400 flex flex-col items-center"><i class="fas fa-chart-bar"></i><span
                    class="text-[10px]">Market</span></a>
            <a href="/invest" class="text-slate-500 flex flex-col items-center"><i class="fas fa-brain"></i><span
                    class="text-[10px]">AI</span></a>
            <button @click="showDonate = true" class="text-pink-400 flex flex-col items-center"><i
                    class="fas fa-heart"></i><span class="text-[10px]">Support</span></a>
        </nav>

        <!-- Main -->
        <main class="flex-1 flex flex-col h-full bg-[#0B0E14] overflow-hidden pb-16 lg:pb-0">
            <header
                class="h-20 border-b border-slate-800 flex items-center justify-between px-8 bg-[#0B0E14]/80 backdrop-blur-md sticky top-0 z-10">
                <div>
                    <h1 class="text-2xl font-bold text-white">Market Tracker</h1>
                    <p class="text-xs text-slate-400">Live BSE Indices & Sovereign Bonds</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="toggleTheme"
                        class="w-10 h-10 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
                        <i :class="isDarkMode ? 'fas fa-sun text-yellow-500' : 'fas fa-moon text-blue-500'"></i>
                    </button>
                    <a href="/" class="px-4 py-2 bg-blue-600 rounded-lg text-sm font-medium">Dashboard</a>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 lg:p-8">
                <!-- Tabs -->
                <div class="flex space-x-6 mb-8 border-b border-slate-800">
                    <button @click="currentTab = 'stocks'"
                        :class="currentTab === 'stocks' ? 'text-white border-b-2 border-purple-500' : 'text-slate-500'"
                        class="pb-2 font-bold px-2 transition-all">Stocks</button>
                    <button @click="currentTab = 'bonds'"
                        :class="currentTab === 'bonds' ? 'text-white border-b-2 border-green-500' : 'text-slate-500'"
                        class="pb-2 font-bold px-2 transition-all">SGB & Bonds</button>
                </div>

                <!-- Stocks -->
                <div v-if="currentTab === 'stocks'" class="fade-in space-y-6">
                    <div class="flex space-x-4 overflow-x-auto pb-2 no-scrollbar">
                        <div v-for="index in indices" :key="index.name" class="glass-panel p-4 min-w-[180px]">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-slate-400 font-bold uppercase">[[ index.name ]]</span>
                                <span :class="index.change >= 0 ? 'text-green-400' : 'text-danger-400'">[[ index.change
                                    ]]%</span>
                            </div>
                            <div class="text-xl font-bold text-white">₹[[ index.price.toLocaleString() ]]</div>
                        </div>
                    </div>

                    <div class="glass-panel overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-slate-900/50 text-xs font-bold text-slate-500 border-b border-slate-800">
                                <tr>
                                    <th class="p-4">Symbol</th>
                                    <th class="p-4 text-right">Price</th>
                                    <th class="p-4 text-right">Day Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="stock in stocks" :key="stock.symbol"
                                    class="border-b border-slate-800 hover:bg-slate-800/30">
                                    <td class="p-4">
                                        <div class="font-bold text-white">[[ stock.symbol ]]</div>
                                        <div class="text-[10px] text-slate-500">[[ stock.name ]]</div>
                                    </td>
                                    <td class="p-4 text-right font-mono text-white">₹[[
                                        stock.price.toLocaleString('en-IN') ]]</td>
                                    <td class="p-4 text-right font-mono"
                                        :class="stock.change >= 0 ? 'text-green-400' : 'text-red-400'">
                                        [[ stock.change > 0 ? '+' : '' ]][[ stock.change ]]%
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Bonds -->
                <div v-if="currentTab === 'bonds'" class="fade-in space-y-6">
                    <div class="p-4 bg-yellow-900/10 border border-yellow-700/20 rounded-xl text-sm text-yellow-500">
                        <i class="fas fa-info-circle mr-2"></i> Sovereign Gold Bonds (SGB) offer 2.5% p.a. interest plus
                        gold appreciation.
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-for="bond in bonds" class="glass-panel p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <div class="text-xs font-bold text-purple-400 uppercase">[[ bond.type ]]</div>
                                    <div class="text-lg font-bold text-white">[[ bond.name ]]</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl font-bold text-green-400">[[ bond.yield ]]% Yield</div>
                                </div>
                            </div>
                            <div
                                class="flex justify-between text-xs text-slate-400 mt-4 pt-4 border-t border-slate-800">
                                <span>Maturity: [[ bond.maturity ]]</span>
                                <span>LTP: ₹[[ bond.price.toLocaleString('en-IN') ]]</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modals -->
        <div v-if="showDonate" class="fixed inset-0 z-[100] flex items-center justify-center p-4">
            <div @click="showDonate = false" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
            <div
                class="relative bg-slate-900 border border-slate-700 p-8 rounded-2xl w-full max-w-sm text-center shadow-2xl">
                <div class="w-16 h-16 bg-pink-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-heart text-2xl text-pink-500"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Support IntelliVest</h3>
                <p class="text-sm text-slate-400 mb-6">Help us keep the servers running!</p>
                <div class="bg-white p-2 rounded-xl mb-6 inline-block">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=upi://pay?pa=faisal19262@oksbi&pn=Faisal%20Ansari&cu=INR"
                        alt="QR" class="w-40 h-40">
                </div>
                <div @click="copyUPI"
                    class="bg-slate-800 p-3 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-700 flex justify-between items-center px-4">
                    <span class="text-xs font-mono">faisal19262@oksbi</span>
                    <span class="text-[10px] font-bold text-pink-500 uppercase">[[ copied ? 'Copied' : 'Copy' ]]</span>
                </div>
                <button @click="showDonate = false" class="mt-6 text-slate-500 text-xs hover:text-white">Close</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            delimiters: ['[[', ']]'],
            data() {
                return {
                    currentTab: 'stocks',
                    showDonate: false,
                    showProfileMenu: false,
                    copied: false,
                    isDarkMode: true,
                    indices: [
                        { name: 'Sensex', price: 0, change: 0 },
                        { name: 'Nifty 50', price: 0, change: 0 },
                        { name: 'Bank Nifty', price: 0, change: 0 }
                    ],
                    stocks: [
                        { symbol: 'RELIANCE', name: 'Reliance Industries', price: 2950.45, change: 1.25 },
                        { symbol: 'TCS', name: 'Tata Consultancy Services', price: 4120.30, change: -0.45 },
                        { symbol: 'INFY', name: 'Infosys Ltd', price: 1680.50, change: 2.10 },
                        { symbol: 'TATAMOTORS', name: 'Tata Motors', price: 980.25, change: 3.40 },
                        { symbol: 'BAJFINANCE', name: 'Bajaj Finance', price: 6540.90, change: 1.80 }
                    ],
                    bonds: [
                        { name: 'SGB 2024 Series IV', type: 'SGB', maturity: '2032', price: 6250, yield: 2.5 },
                        { name: '7.18% GS 2033', type: 'G-Sec', maturity: '2033', price: 100.45, yield: 7.12 },
                        { name: '7.30% GS 2053', type: 'G-Sec', maturity: '2053', price: 101.2, yield: 7.3 }
                    ],
                    session: {
                        name: {{ session.get('name', 'User') | tojson }
            },
            initials: {{ session.get('initials', 'U') | tojson }},
            user: {{ session.get('user', 'user@example.com') | tojson }}
                    }
                }
            },
            mounted() {
            this.isDarkMode = localStorage.getItem('theme') !== 'light';
            this.updateTheme();
            this.loadData();
            setInterval(this.loadData, 30000);
            },
        methods: {
                async loadData() {
                try {
                    const idxRes = await fetch('/api/market/indices');
                    const idxData = await idxRes.json();
                    if (Array.isArray(idxData)) this.indices = idxData;

                    const stkRes = await fetch('/api/market/stocks', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbols: this.stocks.map(s => s.symbol) })
                    });
                    const stkData = await stkRes.json();
                    if (Array.isArray(stkData)) {
                        stkData.forEach(d => {
                            const s = this.stocks.find(x => x.symbol === d.symbol);
                            if (s) { s.price = d.price; s.change = d.change; }
                        });
                    }
                } catch (e) { }
            },
            toggleTheme() {
                this.isDarkMode = !this.isDarkMode;
                localStorage.setItem('theme', this.isDarkMode ? 'dark' : 'light');
                this.updateTheme();
            },
            updateTheme() {
                if (this.isDarkMode) document.body.classList.remove('light-mode');
                else document.body.classList.add('light-mode');
            },
            copyUPI() {
                navigator.clipboard.writeText('faisal19262@oksbi');
                this.copied = true;
                setTimeout(() => this.copied = false, 2000);
            }
        }
        }).mount('#app');
    </script>
</body>

</html>